<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Localhost:9999 Prebid.js testing</title>
        <script type="text/javascript" src="/build/dev/prebid.js" async></script>

<!-- A template of a Prebid HTML is located at ../integrationexamples/gpt/load_prebid_before_dfp_example.html. This page is built using that as a template. I have a few index.html tries that I am basing off different templates to try and figure this out. I am naming each one creatively. -->
<!-- This one uses the load_pbjs_before_dfp example. -->

    <script>
    var PREBID_TIMEOUT = 700;

    var googletag = googletag || {};
    googletag.cmd = googletag.cmd || [];

    function initAdserver() {
      if (pbjs.initAdserverSet) return;
      //load GPT library here
      loadScript('//www.googletagservices.com/tag/js/gpt.js');
      pbjs.initAdserverSet = true;
    };
    // Load GPT when timeout is reached if bidders haven't responded.
    setTimeout(initAdserver, PREBID_TIMEOUT);

    var pbjs = pbjs || {};
    pbjs.que = pbjs.que || [];

    // Load the Prebid Javascript Library Async. We recommend loading it immediately after
    // the initAdserver() and setTimeout functions.
    loadScript('//acdn.adnxs.com/prebid/not-for-prod/prebid.js');

    function loadScript(scriptSrc) {
      var script = document.createElement('script');
      script.async=true;
      script.type = 'text/javascript';
      script.src = scriptSrc;
      var node = document.getElementsByTagName('script')[0];
      node.parentNode.insertBefore(script, node);
     }

    pbjs.que.push(function() {
      var adUnits = [{
        code: 'div-gpt-ad-1486672287569-0',
        sizes: [[300, 250]],
        bids: [{
          bidder: 'sovrn',
          params: {
           tagid:'666'
            }
        }]
      }];

    //add the adUnits to the prebid request
    pbjs.addAdUnits(adUnits);

    /* Request bids for the added ad units. If adUnits or adUnitCodes are
     not specified, the function will request bids for all added ad units.
     */
    pbjs.requestBids({

      /* The bidsBack function will be called when either timeout is
       reached, or when all bids come back, whichever happens sooner.
       */
      bidsBackHandler: function (bidResponses) {
          initAdserver();

      },
      timeout : PREBID_TIMEOUT
    });
}); // end of the push command
</script>

<script>
  googletag.cmd.push(function() {
    var rightSlot = googletag.defineSlot('/3847125/prebidTest', [[300, 250], [300, 600]], 'div-gpt-ad-1486672287569-0').addService(googletag.pubads());
    pbjs.que.push(function() {
       pbjs.setTargetingForGPTAsync();
    });
  googletag.pubads().enableSingleRequest();
  googletag.enableServices();
  });
</script>

  </head>

  <body>
    <h2>DFP ad div:</h2>
    <div id='div-gpt-ad-1486672287569-0' style='height:250px; width:300px; border:1px solid black'>
      <script type='text/javascript'>
      googletag.cmd.push(function() { googletag.display('div-gpt-ad-1486672287569-0'); });
      </script>
    </div>

    <div>
      <h4>Here are some kittens for motivation:</h4>
      <img src="http://placekitten.com/300/250" alt="">
    </div>

  </body>
</html>
