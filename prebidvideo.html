<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <style type="text/css" media="screen">
    </style>

    <link rel="stylesheet" href="http://vjs.zencdn.net/5.9.2/video-js.css">
 <script type="text/javascript" src="http://vjs.zencdn.net/5.9.2/video.js"></script>

 <!-- I added jquery:  -->
 <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.11.0/jquery-ui.min.js"></script>

 <!-- videojs-vast-vpaid -->
 <link href="https://cdnjs.cloudflare.com/ajax/libs/videojs-vast-vpaid/2.0.2/videojs.vast.vpaid.min.css" rel="stylesheet">
 <script src="https://cdnjs.cloudflare.com/ajax/libs/videojs-vast-vpaid/2.0.2/videojs_5.vast.vpaid.min.js"></script>

    <title>Prebid Video Adapter Test</title>
        <script type="text/javascript" src="build/dist/prebid.js" async></script>
    <script>
      var PREBID_TIMEOUT = 1500;

	var videoAdUnit = {
 	 code: 'video',
 	 sizes: [640,480],
 	 mediaType: 'video',
   bidfloor: 0.19,
 	 bids: [
   	 {
     	 bidder: 'beachfront',
     	 params: {
       	 aid: '0a47f4ce-d91f-48d0-bd1c-64fa2c196f13',
            video: {
              skippable: false
            }
      	}
    	}
  ]
};
      var pbjs = pbjs || {};
      pbjs.que = pbjs.que || [];
    </script>

<script>


   	pbjs.que.push(function() {
        pbjs.addAdUnits(videoAdUnit);
        pbjs.requestBids({
            bidsBackHandler: function(bids){
              console.log('Page received bids back: ');
              console.log(bids);

            try {
              url = bids.video.bids[0].vastUrl;
              console.log('VAST URL: + url');
              } catch (e) {} // ignore
              var adserverTag = "https://www.techniqal.com/tmp/bf/vast_media.php?";
              // var adserverTag = 'https://pubads.g.doubleclick.net/gampad/ads?sz=640x480&iu=/3847125/prebid_video&impl=s&gdfp_req=1&env=vp&output=vast&unviewed_position_start=1&url=techniqal.com';
              adserverTag = adserverTag + '&correlator=' + Date.now();

               var options = {
                 'adserver': 'dfp',
                 'code': 'video' // Must match the code from the `videoAdUnit` above
               };

           // Generate DFP Video Ad Server Tag URL
              var masterTagUrl = pbjs.buildMasterVideoTagFromAdserverTag(adserverTag, options);

              console.log('buildMasterVideoTagFromAdserverTag: ' + masterTagUrl);

           // Send masterTagUrl to the video player
              invokeVideoPlayer(masterTagUrl);

            }
        });
    });

    function sendAdserverRequest() {
        if (pbjs.adserverRequestSent) return;
        pbjs.adserverRequestSent = true;

    }


    // pbjs.bidderSettings =
    //    {
    //        standard: {
    //            adserverTargeting: [
    //                {
    //                    key: "hb_bidder",
    //                    val: function (bidResponse) {
    //                        return bidResponse.bidderCode;
    //                    }
    //                }, {
    //                    key: "hb_adid",
    //                    val: function (bidResponse) {
    //                        return bidResponse.adId;
    //                    }
    //                }, {
    //                    key: "hb_pb",
    //                    val: function (bidResponse) {
    //                      // update this value XXX
    //                        return ".51";
    //                    }
    //                }, {
    //                    key: "hb_size",
    //                    val: function (bidResponse) {
    //                        return bidResponse.size;
    //
    //                    }
    //                }
    //            ]
    //        }
    //    };


</script>

    <!-- Header tag, generated by DFP -->
  </head>


  <body>

    <h2>Prebid Video -- video.js</h2>

    <div class="example-video-container">

      <video id="vid1" class="video-js vjs-default-skin vjs-big-play-centered" controls
        data-setup='{}'
        width='640'
        height='480'
      >
      <source src="http://vjs.zencdn.net/v/oceans.mp4" type='video/mp4'/>
      <source src="http://vjs.zencdn.net/v/oceans.webm" type='video/webm'/>
      <source src="http://vjs.zencdn.net/v/oceans.ogv" type='video/ogg'/>

      </video>
    </div>

    <script>

      var page_load_time;

      page_load_time = new Date().getTime() - performance.timing.navigationStart;
      console.log(page_load_time + "ms -- Player loading!");

      var vid1 = videojs('vid1');

      page_load_time = new Date().getTime() - performance.timing.navigationStart;
      console.log(page_load_time + "ms -- Player loaded!");

      function invokeVideoPlayer(url) {

        page_load_time = new Date().getTime() - performance.timing.navigationStart;
        console.log(page_load_time + "ms -- Prebid VAST url = " + url);

        videojs("vid1").ready(function() {

          page_load_time = new Date().getTime() - performance.timing.navigationStart;
          console.log(page_load_time + "ms -- Player is ready!");

          var player = this;
          var vastAd = player.vastClient({
            adTagUrl: url,
            playAdAlways: true,
            verbosity: 4,
            vpaidFlashLoaderPath: "https://github.com/MailOnline/videojs-vast-vpaid/blob/RELEASE/bin/VPAIDFlash.swf?raw=true",
            autoplay: true
          });

          page_load_time = new Date().getTime() - performance.timing.navigationStart;
          console.log(page_load_time + "ms -- Prebid VAST tag inserted!");

          player.muted(true);
          player.play();

          page_load_time = new Date().getTime() - performance.timing.navigationStart;
          console.log(page_load_time + "ms -- invokeVideoPlayer complete!");

        });
    }

    </script>
  </body>
</html>
